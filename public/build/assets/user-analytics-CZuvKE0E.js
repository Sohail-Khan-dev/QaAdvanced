document.addEventListener("DOMContentLoaded",function(){let r=null;window.firebaseAnalytics&&(r=window.firebaseAnalytics);let t={isAuthenticated:!1,userId:null,userRole:null,loginTime:null,sessionDuration:0};function k(){var e,i;document.querySelectorAll("[data-auth-user]").length>0?(t.isAuthenticated=!0,t.userId=((e=document.querySelector("[data-user-id]"))==null?void 0:e.getAttribute("data-user-id"))||null,t.userRole=((i=document.querySelector("[data-user-role]"))==null?void 0:i.getAttribute("data-user-role"))||null,t.loginTime=new Date,r&&t.userId&&r.setUser(t.userId,{role:t.userRole,login_time:t.loginTime.toISOString()}),r&&r.trackUserEngagement("user_login",{user_id:t.userId,user_role:t.userRole,timestamp:t.loginTime.toISOString()})):r&&r.trackUserEngagement("anonymous_user",{page_name:window.location.pathname,timestamp:new Date().toISOString()})}function S(n,e=!0,i=null){r&&r.trackUserEngagement("authentication_event",{event_type:n,success:e,error_message:i,timestamp:new Date().toISOString()})}function u(n,e=!0){r&&r.trackUserEngagement("profile_update",{field_name:n,success:e,user_id:t.userId,user_role:t.userRole,timestamp:new Date().toISOString()})}function c(n,e={}){r&&r.trackUserEngagement("dashboard_interaction",{action:n,user_id:t.userId,user_role:t.userRole,...e,timestamp:new Date().toISOString()})}function d(n,e=null,i={}){r&&t.userRole==="admin"&&r.trackUserEngagement("admin_action",{action:n,target_id:e,user_id:t.userId,...i,timestamp:new Date().toISOString()})}function l(){if(r){const n=new Date,e=t.loginTime?(n-t.loginTime)/1e3:0;r.trackUserEngagement("user_logout",{user_id:t.userId,user_role:t.userRole,session_duration_seconds:e,timestamp:n.toISOString()})}}function m(){if(r){const n=new Date,e=t.loginTime?(n-t.loginTime)/1e3:0;r.trackUserEngagement("session_timeout",{user_id:t.userId,user_role:t.userRole,session_duration_seconds:e,timestamp:n.toISOString()})}}function h(n,e){r&&r.trackUserEngagement("user_preference",{preference_name:n,preference_value:e,user_id:t.userId,user_role:t.userRole,timestamp:new Date().toISOString()})}function g(n,e=null,i=null){r&&r.trackUserEngagement("user_feedback",{feedback_type:n,rating:e,has_comment:!!i,user_id:t.userId,user_role:t.userRole,timestamp:new Date().toISOString()})}function f(n,e={}){r&&r.trackUserEngagement("help_request",{help_type:n,user_id:t.userId,user_role:t.userRole,...e,timestamp:new Date().toISOString()})}k(),document.addEventListener("click",function(n){n.target.closest("[data-logout]")&&l()}),document.addEventListener("submit",function(n){const e=n.target.closest("form[data-profile-form]");if(e){const i=new FormData(e),s=[];for(let[o,a]of i.entries())a&&o!=="_token"&&o!=="_method"&&s.push(o);s.length>0&&s.forEach(o=>{u(o,!0)})}}),document.addEventListener("click",function(n){const e=n.target.closest("[data-dashboard-action]");if(e){const i=e.getAttribute("data-dashboard-action");c(i)}}),document.addEventListener("click",function(n){const e=n.target.closest("[data-admin-action]");if(e){const i=e.getAttribute("data-admin-action"),s=e.getAttribute("data-target-id");d(i,s)}}),document.addEventListener("submit",function(n){var i,s;const e=n.target.closest("form[data-feedback-form]");if(e){const o=e.getAttribute("data-feedback-type")||"general",a=(i=e.querySelector('input[name="rating"]:checked'))==null?void 0:i.value,I=(s=e.querySelector('textarea[name="comment"]'))==null?void 0:s.value;g(o,a,I)}}),document.addEventListener("click",function(n){const e=n.target.closest("[data-help-request]");if(e){const i=e.getAttribute("data-help-request");f(i)}});let _;function p(){clearTimeout(_),_=setTimeout(()=>{t.isAuthenticated&&m()},30*60*1e3)}["mousedown","mousemove","keypress","scroll","touchstart"].forEach(n=>{document.addEventListener(n,p,!0)}),t.isAuthenticated&&p(),window.addEventListener("beforeunload",function(){if(t.isAuthenticated&&t.loginTime){const n=new Date,e=(n-t.loginTime)/1e3;r&&r.trackUserEngagement("session_end",{user_id:t.userId,user_role:t.userRole,session_duration_seconds:e,timestamp:n.toISOString()})}}),window.userAnalytics={trackAuthEvent:S,trackProfileUpdate:u,trackDashboardInteraction:c,trackAdminAction:d,trackUserLogout:l,trackSessionTimeout:m,trackUserPreference:h,trackUserFeedback:g,trackHelpRequest:f,userState:t}});
