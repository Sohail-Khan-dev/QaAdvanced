$(document).ready(function(){y();let p=window.topics,c=null,g=null;$(document).on("submit","#new-blog-form",function(o){o.preventDefault(),$(this).find("#save-btn").prop("disabled",!0);let t=$(this).find(".topic-html").summernote("code");const r=$(this).find(".form-id").val()?"/update-blog":"/store-blog";let a=new FormData(this);a.append("content",t),$.ajax({url:r,method:"POST",data:a,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){$("#new-blog-modal").modal("hide"),d(),g=n.blogs,i("blog-dataTable",n.blogs,"blog-content")},error:function(n,l,s){console.error("Error:",n.responseText,l,s)}})}),$(document).on("submit","#new-question-form",function(o){if(o.preventDefault(),!$('input[name="correct_option"]:checked').val())return $("#correct-option-error").length||$('<div id="correct-option-error" class="alert alert-danger mt-2">Please select a correct answer option</div>').insertAfter('.mb-3:has(input[name="correct_option"])'),$("#correct-option-error")[0].scrollIntoView({behavior:"smooth",block:"center"}),$(this).find("#save-btn").prop("disabled",!1),!1;$("#correct-option-error").remove(),$(this).find("#save-btn").prop("disabled",!0);let t=$(this).find(".topic-html").summernote("code"),e=$(this).find("#explanation").summernote("code"),r=new FormData(this);r.append("question",t),r.append("explanation",e),$.ajax({url:"/store-question",method:"POST",data:r,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){$("#new-question-modal").modal("hide"),d(),m("/get-questions","question-content","question-dataTable")},error:function(a,n,l){if(a.status===422){let s=a.responseJSON.errors;s.correct_option&&$('<div id="correct-option-error" class="alert alert-danger mt-2">'+s.correct_option[0]+"</div>").insertAfter('.mb-3:has(input[name="correct_option"])')}console.error("Error:",a.responseText,n,l),$("#new-question-form").find("#save-btn").prop("disabled",!1)}})}),$(document).on("submit","#learning-category-form",function(o){o.preventDefault(),$(this).find("#save-btn").prop("disabled",!0);const e=$(this).find(".form-id").val()?"/update-category":"/store-category";let r=$(this).find(".topic-html").summernote("code"),a=new FormData(this);a.append("slug",r),$.ajax({url:e,method:"POST",data:a,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){$("#learning-category-modal").modal("hide"),d(),c=n.categories||n.categorys,T(c),i("learning-category-dataTable",c,"learning-category")},error:function(n,l,s){console.error("Error:",n.responseText,l,s)}})}),$(document).on("submit","#topic-list-form",function(o){o.preventDefault(),$(this).find("#save-btn").prop("disabled",!0);const e=$(this).find(".form-id").val()?"/update-topic":"/store-topic";let r=$(this).find(".topic-html").summernote("code"),a=new FormData(this);a.append("slug",r),$.ajax({url:e,method:"POST",data:a,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){$("#topic-list-modal").modal("hide"),d(),p=n.topics,i("topic-list-dataTable",n.topics,"topic-list")},error:function(n,l,s){console.error("Error:",n.responseText,l,s)}})}),$(document).on("submit","#quiz-category-form",function(o){o.preventDefault(),$(this).find("#save-btn").prop("disabled",!0);let t=new FormData(this);$.ajax({url:"store-quiz-category",method:"post",data:t,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){$("#quiz-category-modal").modal("hide"),d();const r=e.quizCategories||e.quizCategorys;h(r),i("quiz-category-dataTable",r,"quiz-category")},error:function(e){console.error("Error:",e.responseText),$("#quiz-category-form").find("#save-btn").prop("disabled",!1)}})}),$(document).on("submit","#new-quiz-form",function(o){o.preventDefault(),$(this).find("#save-btn").prop("disabled",!0);let t=new FormData(this);$.ajax({url:"/store-quiz",method:"post",data:t,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){$("#new-quiz-modal").modal("hide"),d(),i("quiz-dataTable",e.quizzes,"quiz-content")},error:function(e){console.error("Error creating quiz:",e.responseText),alert("Error creating quiz: "+e.responseText),$("#new-quiz-form").find("#save-btn").prop("disabled",!1)}})}),$(document).on("click","#new-blog-btn, #new-question-btn, #topic-list-btn, #learning-category-btn, #new-quiz-category-btn",function(){d(),$(".save-btn").prop("disabled",!1)});function m(o,t=null,e=null){t!==null&&$.ajax({url:o,method:"GET",dataType:"json",headers:{Accept:"application/json"},success:function(r){t==="blog-content"?g=r:t==="learning-category"?c=r:t==="topic-list"&&(p=r),i(e,r,t)}})}function u(o){return`<a href="#" class="btn btn-success btn-sm edit-btn" data-id=${o}>Edit</a><a href="#" class="btn btn-danger btn-sm del-btn" data-id=${o}>Delete</a>`}$(document).on("click",".edit-btn",function(){$(".save-btn").prop("disabled",!1);let o=$(this).data("id");if($(".form-id").val(o),$(this).closest("#learning-category").length){let t=c.find(e=>e.id==o);$("#category-id").val(t.id),$(".name").val(t.name),$(".topic-html").summernote("code",t.slug),$(".topic-html").trigger("summernote.change"),$("#learning-category-modal").modal("show")}else if($(this).closest("#topic-list").length){let t=p.find(e=>e.id==o);$("#topic-id").val(t.id),$(".name").val(t.name),$(".category-id").val(t.learning_category_id),$(".topic-html").summernote("code",t.slug),$(".topic-html").trigger("summernote.change"),$("#topic-list-modal").modal("show")}else if($(this).closest("#blog-content").length){let t=g.find(e=>e.id==o);$("#blog-id").val(t.id),$("#category-id").val(t.learning_category_id).change(),$("#title").val(t.title),$("#topic-id").val(t.slug),$(".topic-html").summernote("code",t.content),$(".topic-html").trigger("summernote.change"),$("#new-blog-modal").modal("show")}}),$(document).on("click",".del-btn",function(){let o=$(this).data("id");if($(this).closest("#topic-list").length){let t="/delete-topic/"+o;$.ajax({url:t,method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){p=e.topics,i("topic-list-dataTable",e.topics,"topic-list")},error:function(e){console.error("Error deleting topic:",e.responseText),alert("Error deleting topic: "+e.responseText)}})}else if($(this).closest("#learning-category").length){let t="/delete-category/"+o;$.ajax({url:t,method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){c=e.categories||e.categorys,T(c),i("learning-category-dataTable",c,"learning-category")},error:function(e){console.error("Error deleting category:",e.responseText),alert("Error deleting category: "+e.responseText)}})}else if($(this).closest("#blog-content").length){let t="/delete-blog/"+o;$.ajax({url:t,method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){g=e.blogs,i("blog-dataTable",e.blogs,"blog-content")},error:function(e){console.error("Error deleting blog:",e.responseText),alert("Error deleting blog: "+e.responseText)}})}else if($(this).closest("#quiz-content").length){let t="/delete-quiz/"+o;$.ajax({url:t,method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){i("quiz-dataTable",e,"quiz-content")},error:function(e){console.error("Error deleting quiz:",e.responseText),alert("Error deleting quiz: "+e.responseText)}})}else if($(this).closest("#quiz-category").length){let t="/delete-quiz-category/"+o;$.ajax({url:t,method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){const r=e.quizCategories||e.quizCategorys||e.quizCategory;h(r),i("quiz-category-dataTable",r,"quiz-category")},error:function(e){console.error("Error deleting quiz category:",e.responseText),alert("Error deleting quiz category: "+e.responseText)}})}else if($(this).closest("#question-content").length){let t="/delete-question/"+o;$.ajax({url:t,method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){i("question-dataTable",e,"question-content")},error:function(e){console.error("Error deleting question:",e.responseText),alert("Error deleting question: "+e.responseText)}})}});function i(o,t,e){var r=$("#"+o).DataTable().clear().draw();$.each(t,function(a,n){if(e==="blog-content"){var l=n.content,s=l.split(/\s+/).slice(0,25).join(" ");r.row.add([n.id,n.title,s,n.slug,u(n.id)]).draw(!1)}else if(e==="question-content"){var E=n.options.map(f=>f.option?f.option.split(/\s+/).slice(0,10).join(" "):"N/A").join(" | "),w=n.question.split(/\s+/).slice(0,20).join(" "),z=n.options.filter(f=>f.is_correct==1).map(f=>f.option).join(", ");r.row.add([n.id,w,E,z,u(n.id)]).draw(!1)}else e==="learning-category"?r.row.add([n.id,n.name,u(n.id)]).draw(!1):e==="topic-list"?r.row.add([n.id,n.name,n.learning_category_id,u(n.id)]).draw(!1):e==="quiz-content"?r.row.add([n.id,n.title,n.questions==null?"No Question":n.questions.length,u(n.id)]).draw(!1):e=="quiz-category"&&r.row.add([n.id,n.name,u(n.id)]).draw(!1)})}$(".blog-link").on("click",function(o){o.preventDefault(),q();var t=$(this).data("content");$("#"+t).removeClass("d-none");let e=$(this).data("url"),r=$(this).data("table");m(e,t,r)});function q(){$("#blog-content").addClass("d-none"),$("#question-content").addClass("d-none"),$("#learning-category").addClass("d-none"),$("#topic-list").addClass("d-none"),$("#quiz-content").addClass("d-none"),$("#quiz-category").addClass("d-none")}function d(){$("#topic-id").val(""),$(".name").val(""),$(".category-id").val(""),$(".topic-html").summernote("code",""),$(".topic-html").trigger("summernote.change"),$(".form-id").val(""),$("div>input.option").val(""),$('input[name="correct_option"]').prop("checked",!1),$("#question-html").summernote("code",""),$("#question-html").trigger("summernote.change")}function y(){$(".topic-html").summernote({height:300,minHeight:200,placeholder:"Write your detail here...",callbacks:{onImageUpload:function(o){for(let t=0;t<o.length;t++){if(o[t].size>5e6){alert("Image file is too large (max 5MB)");continue}b(o[t],this)}}}}),$("#question").summernote({height:70,minHeight:50,maxHeight:300,placeholder:"Write your question here...",callbacks:{onImageUpload:function(o){for(let t=0;t<o.length;t++){if(o[t].size>5e6){alert("Image file is too large (max 5MB)");continue}b(o[t],this)}}}})}function h(o){const t=$("#quiz-category-id");t.length&&(t.find("option:not(:first)").remove(),$.each(o,function(e,r){t.append(new Option(r.name,r.id))}))}function b(o,t){const e=new FormData;e.append("file",o),$.ajax({url:"/upload-image",method:"POST",data:e,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){$(t).summernote("insertImage",r.url,function(a){a.addClass("img-fluid")})},error:function(r){var n;const a=((n=r.responseJSON)==null?void 0:n.error)||"Upload failed";alert("Image upload failed: "+a)}})}$("#category-id").on("change",function(){v($(this).val())});function v(o){let t=p.filter(e=>e.learning_category_id==o);populateTopics(t)}function T(o){let t=$(".category-id");t.find("option:not(:first)").remove(),$.each(o,function(e,r){let a=`<option value="${r.id}">${r.name}</option>`;t.append(a)})}});
