$(document).ready(function(){let a=null;window.firebaseAnalytics&&(a=window.firebaseAnalytics),v();let m=window.topics,d=null,p=null;$(document).on("submit","#new-blog-form",function(o){o.preventDefault(),$(this).find("#save-btn").prop("disabled",!0);let t=$(this).find(".topic-html").summernote("code");const e=$(this).find(".form-id").val(),r=e?"/update-blog":"/store-blog";let i=new FormData(this);i.append("content",t),a&&(a.trackFormSubmission("blog_form",!0),a.trackBlogInteraction(e?"update_blog":"create_blog",e)),$.ajax({url:r,method:"POST",data:i,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){$("#new-blog-modal").modal("hide"),u(),p=n.blogs,s("blog-dataTable",n.blogs,"blog-content"),a&&(a.trackFormSubmission("blog_form",!0),a.trackUserEngagement("blog_operation_success",{operation:e?"update":"create",blog_count:n.blogs?n.blogs.length:0}))},error:function(n,c,l){console.error("Error:",n.responseText,c,l),a&&(a.trackFormSubmission("blog_form",!1,l),a.trackUserEngagement("blog_operation_error",{operation:e?"update":"create",error:l}))}})}),$(document).on("submit","#new-question-form",function(o){if(o.preventDefault(),!$('input[name="correct_option"]:checked').val())return $("#correct-option-error").length||$('<div id="correct-option-error" class="alert alert-danger mt-2">Please select a correct answer option</div>').insertAfter('.mb-3:has(input[name="correct_option"])'),$("#correct-option-error")[0].scrollIntoView({behavior:"smooth",block:"center"}),$(this).find("#save-btn").prop("disabled",!1),!1;$("#correct-option-error").remove(),$(this).find("#save-btn").prop("disabled",!0);let t=$(this).find(".topic-html").summernote("code"),e=$(this).find("#explanation").summernote("code"),r=new FormData(this);r.append("question",t),r.append("explanation",e),a&&(a.trackFormSubmission("question_form",!0),a.trackQuizInteraction("create_question")),$.ajax({url:"/store-question",method:"POST",data:r,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(i){$("#new-question-modal").modal("hide"),u(),h("/get-questions","question-content","question-dataTable"),a&&(a.trackFormSubmission("question_form",!0),a.trackUserEngagement("question_creation_success",{question_count:i.questions?i.questions.length:0}))},error:function(i,n,c){if(i.status===422){let l=i.responseJSON.errors;l.correct_option&&$('<div id="correct-option-error" class="alert alert-danger mt-2">'+l.correct_option[0]+"</div>").insertAfter('.mb-3:has(input[name="correct_option"])')}console.error("Error:",i.responseText,n,c),$("#new-question-form").find("#save-btn").prop("disabled",!1),a&&(a.trackFormSubmission("question_form",!1,c),a.trackUserEngagement("question_creation_error",{error:c}))}})}),$(document).on("submit","#learning-category-form",function(o){o.preventDefault(),$(this).find("#save-btn").prop("disabled",!0);const t=$(this).find(".form-id").val();a&&(a.trackFormSubmission("category_form",!0),a.trackUserEngagement("category_operation",{operation:t?"update":"create"}));const e=t?"/update-category":"/store-category";let r=$(this).find(".topic-html").summernote("code"),i=new FormData(this);i.append("slug",r),$.ajax({url:e,method:"POST",data:i,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){$("#learning-category-modal").modal("hide"),u(),d=n.categories||n.categorys,T(d),s("learning-category-dataTable",d,"learning-category")},error:function(n,c,l){console.error("Error:",n.responseText,c,l)}})}),$(document).on("submit","#topic-list-form",function(o){o.preventDefault(),$(this).find("#save-btn").prop("disabled",!0);const e=$(this).find(".form-id").val()?"/update-topic":"/store-topic";let r=$(this).find(".topic-html").summernote("code"),i=new FormData(this);i.append("slug",r),$.ajax({url:e,method:"POST",data:i,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(n){$("#topic-list-modal").modal("hide"),u(),m=n.topics,s("topic-list-dataTable",n.topics,"topic-list")},error:function(n,c,l){console.error("Error:",n.responseText,c,l)}})}),$(document).on("submit","#quiz-category-form",function(o){o.preventDefault(),$(this).find("#save-btn").prop("disabled",!0);let t=new FormData(this);$.ajax({url:"store-quiz-category",method:"post",data:t,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){$("#quiz-category-modal").modal("hide"),u();const r=e.quizCategories||e.quizCategorys;b(r),s("quiz-category-dataTable",r,"quiz-category")},error:function(e){console.error("Error:",e.responseText),$("#quiz-category-form").find("#save-btn").prop("disabled",!1)}})}),$(document).on("submit","#new-quiz-form",function(o){o.preventDefault(),$(this).find("#save-btn").prop("disabled",!0);let t=new FormData(this);$.ajax({url:"/store-quiz",method:"post",data:t,contentType:!1,processData:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){$("#new-quiz-modal").modal("hide"),u(),s("quiz-dataTable",e.quizzes,"quiz-content")},error:function(e){console.error("Error creating quiz:",e.responseText),alert("Error creating quiz: "+e.responseText),$("#new-quiz-form").find("#save-btn").prop("disabled",!1)}})}),$(document).on("click","#new-blog-btn, #new-question-btn, #topic-list-btn, #learning-category-btn, #new-quiz-category-btn",function(){u(),$(".save-btn").prop("disabled",!1)});function h(o,t=null,e=null){t!==null&&$.ajax({url:o,method:"GET",dataType:"json",headers:{Accept:"application/json"},success:function(r){t==="blog-content"?p=r:t==="learning-category"?d=r:t==="topic-list"&&(m=r),s(e,r,t)}})}function f(o){return`<a href="#" class="btn btn-success btn-sm edit-btn" data-id=${o}>Edit</a><a href="#" class="btn btn-danger btn-sm del-btn" data-id=${o}>Delete</a>`}$(document).on("click",".edit-btn",function(){$(".save-btn").prop("disabled",!1);let o=$(this).data("id");if($(".form-id").val(o),$(this).closest("#learning-category").length){let t=d.find(e=>e.id==o);$("#category-id").val(t.id),$(".name").val(t.name),$(".topic-html").summernote("code",t.slug),$(".topic-html").trigger("summernote.change"),$("#learning-category-modal").modal("show")}else if($(this).closest("#topic-list").length){let t=m.find(e=>e.id==o);$("#topic-id").val(t.id),$(".name").val(t.name),$(".category-id").val(t.learning_category_id),$(".topic-html").summernote("code",t.slug),$(".topic-html").trigger("summernote.change"),$("#topic-list-modal").modal("show")}else if($(this).closest("#blog-content").length){let t=p.find(e=>e.id==o);$("#blog-id").val(t.id),$("#category-id").val(t.learning_category_id).change(),$("#title").val(t.title),$("#topic-id").val(t.slug),$(".topic-html").summernote("code",t.content),$(".topic-html").trigger("summernote.change"),$("#new-blog-modal").modal("show")}}),$(document).on("click",".del-btn",function(){let o=$(this).data("id");if($(this).closest("#topic-list").length){let t="/delete-topic/"+o;$.ajax({url:t,method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){m=e.topics,s("topic-list-dataTable",e.topics,"topic-list")},error:function(e){console.error("Error deleting topic:",e.responseText),alert("Error deleting topic: "+e.responseText)}})}else if($(this).closest("#learning-category").length){let t="/delete-category/"+o;$.ajax({url:t,method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){d=e.categories||e.categorys,T(d),s("learning-category-dataTable",d,"learning-category")},error:function(e){console.error("Error deleting category:",e.responseText),alert("Error deleting category: "+e.responseText)}})}else if($(this).closest("#blog-content").length){let t="/delete-blog/"+o;$.ajax({url:t,method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){p=e.blogs,s("blog-dataTable",e.blogs,"blog-content")},error:function(e){console.error("Error deleting blog:",e.responseText),alert("Error deleting blog: "+e.responseText)}})}else if($(this).closest("#quiz-content").length){let t="/delete-quiz/"+o;$.ajax({url:t,method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){s("quiz-dataTable",e,"quiz-content")},error:function(e){console.error("Error deleting quiz:",e.responseText),alert("Error deleting quiz: "+e.responseText)}})}else if($(this).closest("#quiz-category").length){let t="/delete-quiz-category/"+o;$.ajax({url:t,method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){const r=e.quizCategories||e.quizCategorys||e.quizCategory;b(r),s("quiz-category-dataTable",r,"quiz-category")},error:function(e){console.error("Error deleting quiz category:",e.responseText),alert("Error deleting quiz category: "+e.responseText)}})}else if($(this).closest("#question-content").length){let t="/delete-question/"+o;$.ajax({url:t,method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(e){s("question-dataTable",e,"question-content")},error:function(e){console.error("Error deleting question:",e.responseText),alert("Error deleting question: "+e.responseText)}})}});function s(o,t,e){var r=$("#"+o).DataTable().clear().draw();$.each(t,function(i,n){if(e==="blog-content"){var c=n.content,l=c.split(/\s+/).slice(0,25).join(" ");r.row.add([n.id,n.title,l,n.slug,f(n.id)]).draw(!1)}else if(e==="question-content"){var w=n.options.map(g=>g.option?g.option.split(/\s+/).slice(0,10).join(" "):"N/A").join(" | "),z=n.question.split(/\s+/).slice(0,20).join(" "),D=n.options.filter(g=>g.is_correct==1).map(g=>g.option).join(", ");r.row.add([n.id,z,w,D,f(n.id)]).draw(!1)}else e==="learning-category"?r.row.add([n.id,n.name,f(n.id)]).draw(!1):e==="topic-list"?r.row.add([n.id,n.name,n.learning_category_id,f(n.id)]).draw(!1):e==="quiz-content"?r.row.add([n.id,n.title,n.questions==null?"No Question":n.questions.length,f(n.id)]).draw(!1):e=="quiz-category"&&r.row.add([n.id,n.name,f(n.id)]).draw(!1)})}$(".blog-link").on("click",function(o){o.preventDefault(),y();var t=$(this).data("content");$("#"+t).removeClass("d-none");let e=$(this).data("url"),r=$(this).data("table");h(e,t,r)});function y(){$("#blog-content").addClass("d-none"),$("#question-content").addClass("d-none"),$("#learning-category").addClass("d-none"),$("#topic-list").addClass("d-none"),$("#quiz-content").addClass("d-none"),$("#quiz-category").addClass("d-none")}function u(){$("#topic-id").val(""),$(".name").val(""),$(".category-id").val(""),$(".topic-html").summernote("code",""),$(".topic-html").trigger("summernote.change"),$(".form-id").val(""),$("div>input.option").val(""),$('input[name="correct_option"]').prop("checked",!1),$("#question-html").summernote("code",""),$("#question-html").trigger("summernote.change")}function v(){$(".topic-html").summernote({height:300,minHeight:200,placeholder:"Write your detail here...",callbacks:{onImageUpload:function(o){for(let t=0;t<o.length;t++){if(o[t].size>5e6){alert("Image file is too large (max 5MB)");continue}q(o[t],this)}}}}),$("#question").summernote({height:70,minHeight:50,maxHeight:300,placeholder:"Write your question here...",callbacks:{onImageUpload:function(o){for(let t=0;t<o.length;t++){if(o[t].size>5e6){alert("Image file is too large (max 5MB)");continue}q(o[t],this)}}}})}function b(o){const t=$("#quiz-category-id");t.length&&(t.find("option:not(:first)").remove(),$.each(o,function(e,r){t.append(new Option(r.name,r.id))}))}function q(o,t){const e=new FormData;e.append("file",o),$.ajax({url:"/upload-image",method:"POST",data:e,processData:!1,contentType:!1,headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(r){$(t).summernote("insertImage",r.url,function(i){i.addClass("img-fluid")})},error:function(r){var n;const i=((n=r.responseJSON)==null?void 0:n.error)||"Upload failed";alert("Image upload failed: "+i)}})}$("#category-id").on("change",function(){E($(this).val())});function E(o){let t=m.filter(e=>e.learning_category_id==o);populateTopics(t)}function T(o){let t=$(".category-id");t.find("option:not(:first)").remove(),$.each(o,function(e,r){let i=`<option value="${r.id}">${r.name}</option>`;t.append(i)})}});
